/*!
 * jQuery Smart Banner
 * Copyright (c) 2012 Arnold Daniels <arnold@jasny.net>
 * Based on 'jQuery Smart Web App Banner' by Kurt Zenisek @ kzeni.com
 * Edited by Matt Pramschufer @ emoxie.com
 */
!function(t){function i(){var t=document.createElement("smartbanner"),i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var s in i)if(void 0!==t.style[s])return{end:i[s]};return!1}var s=function(i){this.origHtmlMargin=parseFloat(t("html").css("margin-top")),this.options=t.extend({},t.smartbanner.defaults,i);var s=navigator.standalone,n=navigator.userAgent;if(this.options.force)this.type=this.options.force;else if(null!=n.match(/Windows Phone 8/i)&&null!==n.match(/Touch/i))this.type="windows";else if(null!=n.match(/iPhone|iPod/i)||n.match(/iPad/)&&this.options.iOSUniversalApp)null!=n.match(/Safari/i)&&(null!=n.match(/CriOS/i)||window.Number(n.substr(n.indexOf("OS ")+3,3).replace("_","."))<6)?this.type="ios":(null!=n.match(/FBAV/i)||null==n.match(/Safari/i)&&null!=n.match(/Mobile/i))&&(this.type="ios");else if(n.match(/\bSilk\/(.*\bMobile Safari\b)?/)||n.match(/\bKF\w/)||n.match("Kindle Fire"))this.type="kindle";else if(null!=n.match(/Android/i)&&(this.type="android"),!this.type||this.getCookie("sb-closed")||this.getCookie("sb-installed"))return void console.log("donotshow",this.getCookie("sb-closed"));if(this.type&&!s&&!this.getCookie("sb-closed")&&!this.getCookie("sb-installed")){this.scale="auto"==this.options.scale?t(window).width()/window.screen.width:this.options.scale,this.scale<1&&(this.scale=1);var e=t("android"==this.type?'meta[name="google-play-app"]':"ios"==this.type?'meta[name="apple-itunes-app"]':"kindle"==this.type?'meta[name="kindle-fire-app"]':'meta[name="msApplication-ID"]');if(0!=e.length){if("windows"==this.type)this.appId=t('meta[name="msApplication-PackageFamilyName"]').attr("content");else{var o=/app-id=([^\s,]+)/.exec(e.attr("content"));if(!o)return;this.appId=o[1]}this.title=this.options.title?this.options.title:e.data("title")||t("title").text().replace(/\s*[|\-Â·].*$/,""),this.author=this.options.author?this.options.author:e.data("author")||(t('meta[name="author"]').length?t('meta[name="author"]').attr("content"):window.location.hostname),this.iconUrl=e.data("icon-url"),this.price=e.data("price"),this.create(),this.show(),this.listen()}}};s.prototype={constructor:s,create:function(){var i,s=this.options.url?this.options.url:("windows"==this.type?"ms-windows-store:navigate?appid=":"android"==this.type?"market://details?id=":"kindle"==this.type?"amzn://apps/android?asin=":"https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id")+this.appId,n=this.price||this.options.price,e=n?n+" - "+("android"==this.type?this.options.inGooglePlay:"kindle"==this.type?this.options.inAmazonAppStore:"ios"==this.type?this.options.inAppStore:this.options.inWindowsStore):"",o=null===this.options.iconGloss?"ios"==this.type:this.options.iconGloss;"android"==this.type&&this.options.GooglePlayParams&&(s=s+"&referrer="+this.options.GooglePlayParams);var a='<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+e+'</span></div><a href="'+s+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>";this.options.layer?t(this.options.appendToSelector).append(a):t(this.options.appendToSelector).prepend(a),this.options.icon?i=this.options.icon:this.iconUrl?i=this.iconUrl:t('link[rel="apple-touch-icon-precomposed"]').length>0?(i=t('link[rel="apple-touch-icon-precomposed"]').attr("href"),null===this.options.iconGloss&&(o=!1)):t('link[rel="apple-touch-icon"]').length>0?i=t('link[rel="apple-touch-icon"]').attr("href"):t('meta[name="msApplication-TileImage"]').length>0?i=t('meta[name="msApplication-TileImage"]').attr("content"):t('meta[name="msapplication-TileImage"]').length>0&&(i=t('meta[name="msapplication-TileImage"]').attr("content")),i?(t("#smartbanner .sb-icon").css("background-image","url("+i+")"),o&&t("#smartbanner .sb-icon").addClass("gloss")):t("#smartbanner").addClass("no-icon"),this.bannerHeight=t("#smartbanner").outerHeight()+2,this.scale>1&&(t("#smartbanner").css("top",parseFloat(t("#smartbanner").css("top"))*this.scale).css("height",parseFloat(t("#smartbanner").css("height"))*this.scale).hide(),t("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",t(window).width()/this.scale)),t("#smartbanner").css("position",this.options.layer?"absolute":"static")},listen:function(){t("#smartbanner .sb-close").on("click",t.proxy(this.close,this)),t("#smartbanner .sb-button").on("click",t.proxy(this.install,this))},show:function(i){var s=t("#smartbanner");if(s.stop(),this.options.layer)s.animate({top:0,display:"block"},this.options.speedIn).addClass("shown").show(),t(this.pushSelector).animate({paddingTop:this.origHtmlMargin+this.bannerHeight*this.scale},this.options.speedIn,"swing",i);else if(t.support.transition){s.animate({top:0},this.options.speedIn).addClass("shown");var n=function(){t("html").removeClass("sb-animation"),i&&i()};t(this.pushSelector).addClass("sb-animation").one(t.support.transition.end,n).emulateTransitionEnd(this.options.speedIn).css("margin-top",this.origHtmlMargin+this.bannerHeight*this.scale)}else s.slideDown(this.options.speedIn).addClass("shown")},hide:function(i){var s=t("#smartbanner");if(s.stop(),this.options.layer)s.animate({top:-1*this.bannerHeight*this.scale,display:"block"},this.options.speedIn).removeClass("shown"),t(this.pushSelector).animate({paddingTop:this.origHtmlMargin},this.options.speedIn,"swing",i);else if(t.support.transition){"android"!==this.type?s.css("top",-1*this.bannerHeight*this.scale).removeClass("shown"):s.css({display:"none"}).removeClass("shown");var n=function(){t("html").removeClass("sb-animation"),i&&i()};t(this.pushSelector).addClass("sb-animation").one(t.support.transition.end,n).emulateTransitionEnd(this.options.speedOut).css("margin-top",this.origHtmlMargin)}else s.slideUp(this.options.speedOut).removeClass("shown")},close:function(t){t.preventDefault(),this.hide(),this.setCookie("sb-closed","true",this.options.daysHidden)},install:function(){this.options.hideOnInstall&&this.hide(),this.setCookie("sb-installed","true",this.options.daysReminder)},setCookie:function(t,i,s){var n;if(s){var e=new Date;e.setTime(e.getTime()+24*s*60*60*1e3),n="; expires="+e.toGMTString()}else n="";document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(i)+n+"; path=/"},getCookie:function(t){var i,s,n,e=document.cookie.split(";");for(i=0;i<e.length;i++)if(s=e[i].substr(0,e[i].indexOf("=")),n=e[i].substr(e[i].indexOf("=")+1),s=s.replace(/^\s+|\s+$/g,""),s==t)return decodeURI(n);return null},switchType:function(){var i=this;this.hide(function(){i.type="android"==i.type?"ios":"android";var s=t("android"==i.type?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]').attr("content");i.appId=/app-id=([^\s,]+)/.exec(s)[1],t("#smartbanner").detach(),i.create(),i.show()})}},t.smartbanner=function(i){var n=t(window),e=n.data("smartbanner"),o="object"==typeof i&&i;e||n.data("smartbanner",e=new s(o)),"string"==typeof i&&e[i]()},t.smartbanner.defaults={title:null,author:null,price:"FREE",appStoreLanguage:"us",inAppStore:"On the App Store",inGooglePlay:"In Google Play",inAmazonAppStore:"In the Amazon Appstore",inWindowsStore:"In the Windows Store",GooglePlayParams:null,icon:null,iconGloss:null,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:15,daysReminder:90,force:null,hideOnInstall:!0,layer:!1,iOSUniversalApp:!0,appendToSelector:"body",pushSelector:"html"},t.smartbanner.Constructor=s,void 0===t.support.transition&&(t.fn.emulateTransitionEnd=function(i){var s=!1,n=this;t(this).one(t.support.transition.end,function(){s=!0});var e=function(){s||t(n).trigger(t.support.transition.end)};return setTimeout(e,i),this},t(function(){t.support.transition=i()}))}(window.jQuery);